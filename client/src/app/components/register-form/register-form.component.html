<mat-card>
  <mat-card-content>
    <h1 class="mat-title-medium">Create your account</h1>
    <form
      data-test="register-form"
      (ngSubmit)="onSubmit(form)"
      #form="ngForm"
      appPasswordValidator
    >
      <mat-form-field>
        <mat-label>Username</mat-label>
        <input
          data-test="username"
          matInput
          name="username"
          type="text"
          autocomplete="username"
          [(ngModel)]="username"
          #usernameModel="ngModel"
          appUsernameValidator
          [attr.minlength]="USERNAME_MIN_LENGTH"
          [attr.maxlength]="USERNAME_MAX_LENGTH"
          required
          spellcheck="false"
        />
        @if (usernameModel.errors) {
          <mat-error>{{ usernameModel.errors | usernameError }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field>
        <mat-label>Password</mat-label>
        <input
          data-test="password"
          matInput
          name="password"
          [type]="isPasswordVisible() ? 'text' : 'password'"
          autocomplete="new-password"
          [(ngModel)]="password"
          #passwordModel="ngModel"
          maxlength="64"
          [readonly]="!isPasswordServiceLoaded()"
          [placeholder]="isPasswordServiceLoaded() ? '' : 'Loading...'"
          required
        />
        <button
          data-test="password-visibility"
          type="button"
          [matTooltip]="visibilityTooltip()"
          [attr.aria-label]="visibilityTooltip()"
          matSuffix
          mat-icon-button
          (click)="togglePasswordVisibility($event)"
        >
          <mat-icon
            [svgIcon]="isPasswordVisible() ? 'visibility_off' : 'visibility'"
          />
        </button>
        @if (passwordModel.errors) {
          <mat-error>{{ passwordModel.errors | passwordError }}</mat-error>
        }
      </mat-form-field>
      <app-password-strength-meter [isPasswordEmpty]="!password()" />

      <button mat-flat-button type="submit">
        @if (isLoading()) {
          <mat-icon svgIcon="progress_activity" />
        }
        Register
      </button>
    </form>

    <p class="mat-body-medium form-footer">
      Already have an account?
      <a mat-button routerLink="/sign-in">Sign in</a>
    </p>
  </mat-card-content>
</mat-card>
